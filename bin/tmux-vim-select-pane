#!/bin/sh
# Like `tmux select-pane`, but sends a `<C-h/j/k/l>` keystroke if Vim is
# running in the current pane, or only one pane exists.
set -e

cmd="$(tmux display -p '#{pane_current_command}')"
cmd="$(basename "$cmd" | tr A-Z a-z)"
pane_count="$(tmux list-panes | wc -l)"

# echo "cmd: $cmd" >>~/bin/tmux-vim-select-pane.log
# echo $pane_count >>~/bin/tmux-vim-select-pane.log

if [ $cmd = "nvim" ] || [ "$pane_count" -eq 1 ]; then
  # echo "vim chosen" >>~/bin/tmux-vim-select-pane.log
  direction="$(echo "${1#-}" | tr 'lLDUR' '\\hjkl')"
  # echo "send-keys $direction" >>~/bin/tmux-vim-select-pane.log
  # forward the keystroke to Vim
  tmux send-keys "C-$direction"
else
  # echo "tmux chosen $@" >> ~/bin/tmux-vim-select-pane.log
  tmux select-pane "$@"
fi
# echo "end" >> ~/bin/tmux-vim-select-pane.log
# echo "" >> ~/bin/tmux-vim-select-pane.log
